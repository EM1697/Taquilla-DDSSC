@model List<TaquillaITH.Models.Movie>
@{
    ViewData["Title"] = "Venta de boletos";
}
<div id="Step1">
    <div class="text-center container">
        <div class="row">
            <div class="col-12">
                <h1 class="display-4">Catálogo de Películas</h1>
            </div>
        </div>
        <div class="row mt-2 justify-content-md-center">
            <div class="col-6">
                <p>Al dia de:</p>
            </div>
        </div>
            <div class="row mt-2 justify-content-md-center">
            <div class="col-6">
                <input id="datePicker" type="date" class="form-control" placeholder="Fecha" aria-label="Fecha" aria-describedby="addon-wrapping">  
            </div>
        </div>
        <div class="row">
            <hr/>
            @if (Model.Any())
            {
                @foreach (var item in Model)
                {
                    <div class="col-5 mt-2 mb-2 ml-2 mr-2" style="border: solid black 2px;">
                        <h1> @item.Name </h1>
                        <img src="@item.PhotoUrl" width="350" height="600"/>
                        <br/>
                        @foreach (var schedule in item?.Schedule?.Replace(" ", string.Empty).Split(',').ToList())
                        {
                            var horario = schedule;
                            <button type="button" value="@schedule" class="btn btn-primary mt-2 ml-2" onclick="ToggleSelect(@item.Id, '@horario')"
                                    data-toggle="button" aria-pressed="false" autocomplete="off" id="MovieId-@item.Id">
                              @schedule
                            </button>
                        }
                        <br />
                        <div id="@item.Id" class="mt-2 SelectTicket" style="display:none;">
                            <select id="mySelect-@item.Id">
                                <option selected disabled>Seleccione un tipo de boleto</option>
                                <option value="boletoNormal"> Boleto Normal</option>
                                <option value="boleto3D"> Boleto 3D</option>
                                <option value="boletoVIP"> Boleto VIP</option>
                            </select>

                            <div class="form-group">
                                <label class="control-label">Cantidad</label>
                                <input class="form-control" type="number" max="10" min="1" id="ticketAmount" />
                            </div>

                            <label>Sala: @item.Num_Sala</label>
                            <br />
                            <label>Duración: @item.RunningTime</label>
                            <br />

                            <button class="btn btn-outline-success" id="btnSelectButton" onclick="SelectShowTime(@item.Id,@item.Num_Sala)"> Seleccionar función</button>
                        </div>
                    </div>
                    <hr/>
                }
            }
        </div>
    </div>
</div>

<div id="Step2" style="display:none;">
    <partial name="_Step2">
</div>

<script>


    var selectedSchedule = ""; 
    var selectedMovieId =  0;
    var TheatreRoom =  0;               
    var ticketAmount = 0;
    var selectedTicket = "";

    function ToggleSelect(id, schedule)
    {
        $('#' + id).toggle();
        selectedMovieId = id;
        selectedSchedule = schedule;
    }

    $(document).ready(function () {
        var date = new Date();
        var day = date.getDate();
        var month = date.getMonth() + 1;
        var year = date.getFullYear();
        if (month < 10) month = "0" + month;
        if (day < 10) day = "0" + day;
        var today = year + "-" + month + "-" + day;

        $("#datePicker").val(today);
    });

    $("#datePicker").change(function () {
        var daySpace="";
        var date = new Date($("input").val());
        var day = date.getDate() +1;
        (day.toString()).length == 1 ? daySpace="0" : day;
        var month = date.getMonth() +1;
        var year = date.getFullYear();
        var time = year + "-" + month + "-" + daySpace + day + " " + "13:09:00"; 
        $.ajax({
            url: "/TicketSale/Step1",
            type: 'GET',
            data: { 'date': time },
            success: function (data) {
                window.location.href = "/TicketSale/Step1?date="+time;
            }, error: function (data) {
                window.location.href = "/TicketSale/Step1?date="+time;
            }
        });
    });

    function SelectShowTime(id, Num_sala)
    {
        TheatreRoom = Num_sala;
        ticketAmount = $("#ticketAmount").val();
        selectedTicket = $("#mySelect-"+id+" :selected").val();
        $("#Step1").toggle();
        $("#Step2").toggle();
    }

    //$( "#target" ).click(function() {
    //  alert( "Handler for .click() called." );
    //});


    //$.ajax({  
    //        type: "GET",  
    //        url: "/api/StudentAPI/GetAllStudents",  
    //        contentType: "application/json; charset=utf-8",  
    //        dataType: "json",  
    //        success: function (data) {  
    //            //alert(JSON.stringify(data));                  
    //            $("#DIV").html('');   
    //            var DIV = '';  
    //            $.each(data, function (i, item) {  
    //                var rows = "<tr>" +  
    //                    "<td id='RegdNo'>" + item.regNo + "</td>" +  
    //                    "<td id='Name'>" + item.name + "</td>" +  
    //                    "<td id='Address'>" + item.address + "</td>" +  
    //                    "<td id='PhoneNo'>" + item.phoneNo + "</td>" +  
    //                    "<td id='AdmissionDate'>" + Date(item.admissionDate,  
    //                        "dd-MM-yyyy") + "</td>" +  
    //                    "</tr>";  
    //                $('#Table').append(rows);  
    //            }); //End of foreach Loop   
    //            console.log(data);  
    //        }, //End of AJAX Success function  
  
    //        failure: function (data) {  
    //            alert(data.responseText);  
    //        }, //End of AJAX failure function  
    //        error: function (data) {  
    //            alert(data.responseText);  
    //        } //End of AJAX error function  
    //    });         
    //$( "#MovieId-"+id).click(function() {
    //    alert( "Handler for .click() called." );
    //});

    //$(document).ready(function () {
    //    $("#Step2").hide();
    //});

</script>